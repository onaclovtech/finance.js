<html>
<head>
<script src="finance.js"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

</head>
<body>
    <div id="myDiv"></div>
    <div id="tablePrint"> </div>
</body>
<script>
//var finance = Finance();
var finance = Finance.prototype;
var loan_amount = 129340.26-417.0;
var loan_duration = 180;
var loan_rate = 6.5;
//console.log(finance.AMSchedule(loan_amount, 4.5, loan_duration, 1,100))
//console.log(finance.AMSchedule(loan_amount, 1.75, loan_duration, 1, 0)["total interest"])
var targetInterest = finance.AMSchedule(loan_amount, 1.75, loan_duration, 1, 0)["total interest"];
//console.log(finance.AM(loan_amount, 4.5, loan_duration, 1, 0))
//console.log(finance.AMByInterest(loan_amount, 4.5, loan_duration, 1, targetInterest))
var targetPayment = finance.AMByInterest(loan_amount, loan_rate, loan_duration, 1, targetInterest);
//console.log(targetPayment);
//console.log(targetInterest);

//console.log(finance.AMSchedule(loan_amount, loan_rate, loan_duration, 1,targetPayment));

var lineData = [];
var x = [];
var y = [];
for (i=0; i < 2000; i+=100){
    x.push(i);
    y.push(finance.AMSchedule(loan_amount, loan_rate, loan_duration, 1,i)["total interest"]);
    
    lineData.push([i, finance.AMSchedule(loan_amount, loan_rate, loan_duration, 1,i)["total interest"]]);
}
// Show the distribution of interest as your increase your payment
//console.log(lineData);
var trace1 = {
  x: x,
  y: y,
  type: 'scatter',
};


all_rates = []
all_annotations = []
rate_interest_pairs = []
all_rates = []

for (i=3.0, j=0; i<loan_rate; i+= .25, j+=1){
    tmp_payment = finance.AMByInterest(loan_amount, loan_rate, loan_duration, 1,finance.AMSchedule(loan_amount, i, loan_duration, 1, 0)["total interest"]);
    tmp_interest = finance.AMSchedule(loan_amount, loan_rate, loan_duration, 1,tmp_payment)
    console.log(tmp_interest);
    all_rates.push(    {
      type: 'line',
      x0: tmp_payment,
      y0: 0,
      x1: tmp_payment,
      y1: tmp_interest["total interest"],
      line: {
        color: 'rgb(' + Math.floor(Math.random() * 256) + "," + Math.floor(Math.random() * 256) + ","+ Math.floor(Math.random() * 256) + ")",
        width: 4
      }
    });
    all_annotations.push({
      x: tmp_payment,
      y: tmp_interest["total interest"],
      xref: 'x',
      yref: 'y',
      text: i,
      showarrow: true,
      arrowhead: 7,
      ax: 0,
      ay: -40
    })
    rate_interest_pairs.push([tmp_payment, tmp_interest["total interest"], i, tmp_interest["duration"]])
    
}
rate_interest_pairs.push([0, y[0], 6.5, loan_duration])
var layout = {
    title: {
    text:'Effective Interest Rates for $' + loan_amount + " loan",
    font: {
      family: 'Courier New, monospace',
      size: 24
    },
    xref: 'paper',
    x: 0.05,
  },
  xaxis: {
    title: {
      text: 'Amount Extra Paid in $ per month for ' + loan_duration + ' Months',
      font: {
        family: 'Courier New, monospace',
        size: 18,
        color: '#7f7f7f'
      }
    },
  },
  yaxis: {
    title: {
      text: 'Total Interest in $',
      font: {
        family: 'Courier New, monospace',
        size: 18,
        color: '#7f7f7f'
      }
    }
  },annotations: all_annotations,
  shapes : all_rates
  
    }

var data = [trace1];

Plotly.newPlot('myDiv', data, layout);



    var myTable= "<table><tr><td style='width: 100px; color: red;'>Additional Payment</td>";
    myTable+= "<td style='width: 100px; color: red; text-align: right;'>Total Interest on Loan</td>";
    myTable+= "<td style='width: 100px; color: red; text-align: right;'>Effective Interest Rate</td>";
    myTable+= "<td style='width: 100px; color: red; text-align: right;'>Loan Duration (Months)</td>";
    myTable+= "<td style='width: 100px; color: red; text-align: right;'>Loan Duration (Years)</td></tr>";

  for (var i=0; i<rate_interest_pairs.length; i++) {
    myTable+="<td style='width: 100px; text-align: right;'>" + rate_interest_pairs[i][0].toFixed(2) + "</td>";
    myTable+="<td style='width: 100px; text-align: right;'>" + rate_interest_pairs[i][1].toFixed(2) + "</td>";
    myTable+="<td style='width: 100px; text-align: right;'>" + rate_interest_pairs[i][2].toFixed(2) + "</td>";
    myTable+="<td style='width: 100px; text-align: right;'>" + rate_interest_pairs[i][3].toFixed(2) + "</td>";
    myTable+="<td style='width: 100px; text-align: right;'>" + (rate_interest_pairs[i][3]/12.).toFixed(2) + "</td></tr>";
  }
   myTable+="</table>";

 
document.getElementById('tablePrint').innerHTML = myTable;


</script>

</html>
